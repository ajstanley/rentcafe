<?php

declare(strict_types=1);

namespace Drupal\killam_rentcafe\Controller;

use Drupal\Core\Controller\ControllerBase;
use Drupal\Core\Database\Connection;
use Drupal\Core\Entity\EntityTypeManagerInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

/**
 * This controller populates the newly minted field_rentcafe_property_code.
 */
final class AddIdController extends ControllerBase {

  /**
   * The controller constructor.
   */
  public function __construct(
    protected $entityTypeManager,

  ) {}

  /**
   * {@inheritdoc}
   */
  public static function create(ContainerInterface $container): self {
    return new self(
      $container->get('entity_type.manager'),
    );
  }

  /**
   * Builds the response.
   */
  public function __invoke(): array {
    $mappings = $this->get_mapping();
    foreach ($mappings as $pcode => $pid) {
      $query = $this->entityTypeManager->getStorage('node')->getQuery();
      $nids = $query
        ->condition('field_building_id', $pid)
        ->condition('type', 'property')
        ->accessCheck(FALSE)
        ->execute();
      if ($nids) {
        $nid = reset($nids);
        $property = $this->entityTypeManager->getStorage('node')->load($nid);
        $property->set('field_rentcafe_property_code', $pcode);
        $property->save();
      }
    }
    $build['content'] = [
      '#type' => 'item',
      '#markup' => $this->t('Successfully added Rentcafe Property Ids.'),
    ];

    return $build;
  }

  public function get_mapping() {
    return [
      "p1817724" => 140,
      "p1817725" => 957,
      "p1817722" => 86,
      "p0510932" => 130,
      "p0510266" => 146,
      "p0510295" => 471,
      "p0510293" => 469,
      "p0510294" => 470,
      "p0510296" => 472,
      "p0589344" => 850,
      "p0565861" => 843,
      "p0519220" => 712,
      "p0510311" => 739,
      "p0510264" => 143,
      "p0649560" => 951,
      "p0621877" => 925,
      "p0510263" => 142,
      "p1230122" => 1014,
      "p0510936" => 141,
      "p0510262" => 140,
      "p0848212" => 1009,
      "p0510194" => 15,
      "p0510261" => 139,
      "p0510934" => 137,
      "p0649563" => 940,
      "p0518795" => 700,
      "p0895115" => 1034,
      "p1522350" => 1625,
      "p0510302" => 564,
      "p1108595" => 1261,
      "p0510305" => 493,
      "p0736213" => 957,
      "p1343743" => 1179,
      "p1411841" => 1440,
      "p1745714" => 848,
      "p1359246" => 1395,
      "p1812905" => 1064,
      "p0510304" => 612,
      "p0510245" => 99,
      "p0621874" => 1298,
      "p0887014" => 565,
      "p0510260" => 136,
      "p0510259" => 134,
      "p0621872" => 897,
      "p0510271" => 218,
      "p0510201" => 23,
      "p0545517" => 835,
      "p0510258" => 129,
      "p0510315" => 584,
      "p0510282" => 344,
      "p0510321" => 625,
      "p0510248" => 107,
      "p0510246" => 102,
      "p0510320" => 606,
      "p0510268" => 215,
      "p0510325" => 631,
      "p0510322" => 626,
      "p0510220" => 49,
      "p0510213" => 40,
      "p0510211" => 37,
      "p0510209" => 31,
      "p1509677" => 1620,
      "p0510196" => 17,
      "p0510190" => 11,
      "p0510316" => 585,
      "p0892457" => 1022,
      "p0510257" => 127,
      "p0510256" => 126,
      "p0510255" => 125,
      "p0735816" => 772,
      "p0521705" => 608,
      "p0510306" => 565,
      "p0510945" => 495,
      "p0510254" => 123,
      "p0510289" => 411,
      "p1359245" => 1396,
      "p0511140" => 120,
      "p0510284" => 391,
      "p0510253" => 119,
      "p0510252" => 118,
      "p1490727" => 1569,
      "p0510299" => 479,
      "p0510298" => 478,
      "p0510278" => 257,
      "p0510938" => 194,
      "p0510250" => 110,
      "p0510249" => 109,
      "p0510285" => 407,
      "p0510226" => 63,
      "p0551361" => 105,
      "p0510280" => 293,
      "p0510329" => 672,
      "p1359248" => 1393,
      "p1660034" => 1391,
      "p0510247" => 103,
      "p1415018" => 1478,
      "p0510930" => 101,
      "p0658833" => 76,
      "p0510244" => 96,
      "p0510242" => 92,
      "p1367522" => 1572,
      "p0510241" => 91,
      "p0510240" => 89,
      "p0519304" => 474,
      "p1230114" => 1368,
      "p1074522" => 1187,
      "p1077027" => 1194,
      "p0510300" => 484,
      "p1339159" => 1316,
      "p0510238" => 85,
      "p0510239" => 86,
      "p0510236" => 80,
      "p0510235" => 79,
      "p0510234" => 78,
      "p0510232" => 75,
      "p1252229" => 1369,
      "p0510231" => 73,
      "p0511094" => 476,
      "p1359242" => 1394,
      "p0519221" => 1180,
      "p0510223" => 57,
      "p0510286" => 408,
      "p0510324" => 628,
      "p0510292" => 841,
      "p0981045" => 1112,
      "p0510928" => 60,
      "p0510224" => 58,
      "p0510926" => 56,
      "p0510277" => 256,
      "p0621876" => 884,
      "p1392793" => 1477,
      "p0510332" => 69,
      "p0510222" => 53,
      "p0510301" => 485,
      "p0510221" => 52,
      "p0510210" => 34,
      "p1405226" => 1476,
      "p1522341" => 1623,
      "p1367519" => 1307,
      "p1500930" => 1577,
      "p0510924" => 48,
      "p1543512" => 968,
      "p1149360" => 1272,
      "p0557279" => 696,
      "p0510297" => 477,
      "p0510291" => 446,
      "p0510308" => 517,
      "p0510215" => 42,
      "p0510218" => 46,
      "p0510275" => 228,
      "p1739313" => 776,
      "p0510217" => 44,
      "p0510328" => 671,
      "p0510216" => 43,
      "p0510214" => 41,
      "p0510212" => 1736,
      "p0510270" => 217,
      "p0510207" => 29,
      "p0510317" => 586,
      "p0510309" => 521,
      "p0510283" => 345,
      "p0560808" => 773,
      "p0510940" => 1796,
      "p0510947" => 552,
      "p0510287" => 409,
      "p0621875" => 883,
      "p0510206" => 28,
      "p0510205" => 27,
      "p0510208" => 30,
      "p0510228" => 67,
      "p1149285" => 1273,
      "p0510204" => 26,
      "p0510237" => 82,
      "p0510203" => 25,
      "p0510202" => 24,
      "p0510312" => 555,
      "p0510330" => 678,
      "p0510314" => 583,
      "p0510274" => 226,
      "p0510273" => 225,
      "p0510233" => 77,
      "p0510227" => 65,
      "p0510200" => 22,
      "p1476242" => 1378,
      "p0510199" => 20,
      "p0510198" => 19,
      "p0510251" => 117,
      "p0510267" => 214,
      "p0510197" => 18,
      "p1681980" => 1844,
      "p0848218" => 1016,
      "p1681979" => 1799,
      "p0510303" => 621,
      "p0510195" => 16,
      "p1348773" => 1397,
      "p0510281" => 332,
      "p0510269" => 216,
      "p0510193" => 14,
      "p0510323" => 627,
      "p0510219" => 47,
      "p0848220" => 1019,
      "p0510192" => 13,
      "p0510272" => 220,
      "p0510191" => 12,
      "p0519216" => 473,
      "p0614692" => 920,
      "p0848219" => 1018,
      "p0510243" => 94,
      "p0510225" => 62,
      "p0743626" => 845,
      "p0510189" => 10,
      "p0614690" => 919,
      "p0510188" => 9,
      "p0510187" => 8,
      "p0510276" => 235,
      "p0510290" => 420,
      "p0510307" => 737,
      "p0510186" => 7,
      "p0510185" => 6,
      "p0649561" => 950,
      "p1440114" => 1552,
      "p0510319" => 598,
      "p0510318" => 597,
      "p0875058" => 1033,
      "p1082215" => 1237,
      "p1586933" => 1566,
      "p1113336" => 1262,
      "p1498394" => 1567,
      "p1066733" => 1178,
      "p1509469" => 1551,
      "p0521776" => 681,
      "p1191013" => 1299,
      "p0510184" => 5,
      "p0521775" => 795,
      "p0510265" => 145,
      "p0510183" => 4,
      "p1059449" => 1170,
      "p0510942" => 426,
      "p0510327" => 636,
      "p0510182" => 2,
      "p0510326" => 635,
      "p0510288" => 410,
      "p0510181" => 1,
      "p0510230" => 71,
      "p0848215" => 1017,
      "p1514717" => 1572,
    ];
  }

}
